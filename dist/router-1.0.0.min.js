!function(){define("router",["route-recognizer","rsvp","exports"],function(a,b,c){"use strict";function d(a){a&&r(this,a)}function e(a,b){var c=arguments;return function(d){var e=J.call(c,2);return e.push(d),a.apply(b,e)}}function f(a,b){if(!a^!b)return!1;if(!a)return!0;for(var c in a)if(a.hasOwnProperty(c)&&a[c]!==b[c])return!1;return!0}function g(a){d.call(this,a)}function h(a){d.call(this,a),this.params=this.params||{}}function i(a){d.call(this,a)}function j(a){a&&r(this,a),this.data=this.data||{}}function k(a){j.call(this,a)}function l(a){j.call(this,a)}function m(){this.handlerInfos=[]}function n(a,b,c,d){function e(){return f.isAborted?I.reject():void 0}var f=this;if(this.state=c||a.state,this.intent=b,this.router=a,this.data=this.intent&&this.intent.data||{},this.resolvedModels={},this.params={},b&&b.inaccessibleByURL&&(this.urlMethod=null),d)return this.promise=I.reject(d),void 0;if(c){var h=c.handlerInfos.length;h&&(this.targetName=c.handlerInfos[c.handlerInfos.length-1].name);for(var i=0;h>i;++i){var j=c.handlerInfos[i];if(!(j instanceof g))break;this.pivotHandler=j.handler}this.sequence=n.currentSequence++,this.promise=c.resolve(a.async,e,this).fail(function(a){throw a.wasAborted?C(f):(f.trigger("error",a.error,f,a.handlerWithError),f.abort(),a.error)})}else this.promise=I.resolve(this.state)}function o(){this.recognizer=new H,this.reset()}function p(a){return"string"==typeof a||a instanceof String||"number"==typeof a||a instanceof Number}function q(a,b){for(var c=a.recognizer.handlersFor(b),d=[],e=0;e<c.length;e++)d.push.apply(d,c[e].queryParams||[]);return d}function r(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function s(a,b,c){var d=w(a.state,b);u(d.exited,function(a){var b=a.handler;delete b.context,b.exit&&b.exit()}),a.state=b;var e=a.currentHandlerInfos=d.unchanged.slice();u(d.updatedContext,function(a){return t(e,a,!1,c)}),u(d.entered,function(a){return t(e,a,!0,c)})}function t(a,b,c,d){var e=b.handler,f=b.context;return c&&e.enter&&e.enter(),d&&!d()?!1:(y(e,f),z(e,b.queryParams),e.setup&&e.setup(f,b.queryParams),d&&!d()?!1:(a.push(b),!0))}function u(a,b){for(var c=0,d=a.length;d>c&&!1!==b(a[c]);c++);}function v(a,b){a=a||{},b=b||{};var c,d=[];for(c in a)if(a.hasOwnProperty(c)){if(b[c]!==a[c])return!1;d.push(c)}for(c in b)if(b.hasOwnProperty(c)&&!~d.indexOf(c))return!1;return!0}function w(a,b){var c,d,e,f,g,h=a.handlerInfos,i=b.handlerInfos,j={updatedContext:[],exited:[],entered:[],unchanged:[]};for(f=0,g=i.length;g>f;f++){var k=h[f],l=i[f];k&&k.handler===l.handler?v(k.queryParams,l.queryParams)||(e=!0):c=!0,c?(j.entered.push(l),k&&j.exited.unshift(k)):d||k.context!==l.context||e?(d=!0,j.updatedContext.push(l)):j.unchanged.push(k)}for(f=i.length,g=h.length;g>f;f++)j.exited.unshift(h[f]);return j}function x(a,b,c,d){if(a.triggerEvent)return a.triggerEvent(b,c,d),void 0;var e=d.shift();if(!b){if(c)return;throw new Error("Could not trigger event '"+e+"'. There are no active handlers")}for(var f=!1,g=b.length-1;g>=0;g--){var h=b[g],i=h.handler;if(i.events&&i.events[e]){if(i.events[e].apply(i,d)!==!0)return;f=!0}}if(!f&&!c)throw new Error("Nothing handled the event '"+e+"'.")}function y(a,b){a.context=b,a.contextDidChange&&a.contextDidChange()}function z(a,b){a.queryParams=b,a.queryParamsDidChange&&a.queryParamsDidChange()}function A(a){var b,c,d=a&&a.length;return d&&d>0&&a[d-1]&&a[d-1].hasOwnProperty("queryParams")?(c=a[d-1].queryParams,b=J.call(a,0,d-1),[b,c]):[a,null]}function B(a,b){D(a.router,a.sequence,"Resolved all models on destination route; finalizing transition.");var c,d=a.router,e=b.handlerInfos,f=(a.sequence,e[e.length-1].name),g={};for(c=e.length-1;c>=0;--c)r(g,e[c].params);if(a.urlMethod){var h=d.recognizer.generate(f,g);"replace"===a.urlMethod?d.replaceURL(h):d.updateURL(h)}return s(d,b,function(){return!a.isAborted}),a.isAborted?(d.state.handlerInfos=d.currentHandlerInfos,I.reject(C(a))):(x(d,d.currentHandlerInfos,!0,["didTransition"]),d.didTransition&&d.didTransition(d.currentHandlerInfos),d.activeTransition.isActive=!1,d.activeTransition=null,D(d,a.sequence,"TRANSITION COMPLETE."),a.isActive=!1,e[e.length-1].handler)}function C(a){return D(a.router,a.sequence,"detected abort."),new o.TransitionAborted}function D(a,b,c){a.log&&(3===arguments.length?a.log("Transition #"+b+": "+c):(c=b,a.log(c)))}function E(a,b,c){var d,e=b[0]||"/";if(1===b.length&&b[0].hasOwnProperty("queryParams"))throw new Error("not implemented");return"/"===e.charAt(0)?(D(a,"Attempting URL transition to "+e),d=new k({url:e})):(D(a,"Attempting transition to "+e),d=new l({name:b[0],contexts:J.call(b,1)})),F(a,d,c)}function F(a,b,c){var d=a.activeTransition?a.activeTransition.state:a.state;try{var e=b.applyToState(d,a.recognizer,a.getHandler,c);if(e===d)return new n(a);if(c)return s(a,e);var f=new n(a,b,e),g=!1;return a.activeTransition&&(g=!0,a.activeTransition.abort()),a.activeTransition=f,f.promise=f.promise.then(function(b){return a.async(function(){return B(f,b.state)})}),g||x(a,a.state.handlerInfos,!0,["willTransition",f]),f}catch(h){return new n(a,b,null,h)}}function G(a,b,c){var d={};if(p(b))return d[c[0]]=b,d;if(a.serialize)return a.serialize(b,c);if(1===c.length){var e=c[0];return d[e]=/_id$/.test(e)?b.id:b,d}}var H=a["default"],I=b["default"],J=Array.prototype.slice,K=Object.create||function(a){function b(){}return b.prototype=a,new b};d.prototype={name:null,handler:null,params:null,context:null,log:function(a,b){a.log&&a.log(this.name+": "+b)},resolve:function(a,b,c){var d=e(this.checkForAbort,this,b),f=e(this.runBeforeModelHook,this,a,c),g=e(this.getModel,this,a,c),h=e(this.runAfterModelHook,this,a,c),i=e(this.becomeResolved,this,c);return I.resolve().then(d).then(f).then(d).then(g).then(d).then(h).then(d).then(i)},runBeforeModelHook:function(a,b){return b.trigger&&b.trigger(!0,"willResolveModel",b,this.handler),this.runSharedModelHook(a,b,"beforeModel",[])},runAfterModelHook:function(a,b,c){var d=this.name;return this.stashResolvedModel(b,c),this.runSharedModelHook(a,b,"afterModel",[c]).then(function(){return b.resolvedModels[d]})},runSharedModelHook:function(a,b,c,d){this.log(b,"calling "+c+" hook"),this.queryParams&&d.push(this.queryParams),d.push(b);var e=this.handler;return a(function(){var a=e[c]&&e[c].apply(e,d);return a instanceof n?null:a})},getModel:function(){throw new Error("This should be overridden by a subclass of HandlerInfo")},checkForAbort:function(a,b){return I.resolve(a()).then(function(){return b})},stashResolvedModel:function(a,b){a.resolvedModels=a.resolvedModels||{},a.resolvedModels[this.name]=b},becomeResolved:function(a,b){var c=this.params||G(this.handler,b,this.names);return this.stashResolvedModel(a,b),a.params=a.params||{},a.params[this.name]=c,new g({context:b,name:this.name,handler:this.handler,params:c})},shouldSupercede:function(a){if(!a)return!0;var b=a.context===this.context;return a.name!==this.name||this.hasOwnProperty("context")&&!b||this.hasOwnProperty("params")&&!f(this.params,a.params)}},g.prototype=K(d.prototype),g.prototype.resolve=function(){return I.resolve(this)},h.prototype=K(d.prototype),h.prototype.getModel=function(a,b){return this.runSharedModelHook(a,b,"model",[this.params])},i.prototype=K(d.prototype),i.prototype.getModel=function(a,b){return this.log(b,this.name+": resolving provided model"),I.resolve(this.context)},j.prototype.applyToState=function(a){return a},k.prototype=K(j.prototype),k.prototype.applyToState=function(a,b,c){var d,e,f=new m,g=b.recognize(this.url);if(!g)throw new o.UnrecognizedURLError(this.url);var i=!1;for(d=0,e=g.length;e>d;++d){var j=g[d],k=j.handler,l=c(k);if(l.inaccessibleByURL)throw new o.UnrecognizedURLError(this.url);var n=new h({name:k,handler:l,params:j.params}),p=a.handlerInfos[d];i||n.shouldSupercede(p)?(i=!0,f.handlerInfos[d]=n):f.handlerInfos[d]=p}return i?f:a},l.prototype=K(j.prototype),l.prototype.applyToState=function(a,b,c,d){for(var e=new m,f=A([this.name].concat(this.contexts)),h=f[0],i=(f[1],b.handlersFor(h[0])),j=i[i.length-1].handler,k=this.contexts.slice(0),l=i.length,n=[],o=i.length-1;o>=0;--o){var p=i[o],q=p.handler,r=c(q);r.inaccessibleByURL&&(this.inaccessibleByURL=!0);var s=a.handlerInfos[o],t=null;p.names.length>0?t=this.getHandlerInfoForDynamicSegment(q,r,p.names,k,s,j):(t=this.createParamHandlerInfo(q,r,p.names,k,s),n.unshift(o));var u=s;t.shouldSupercede(s)&&(l=o,u=t),d&&(u=new g({context:u.context,name:u.name,handler:u.handler,params:u.params})),e.handlerInfos.unshift(u)}if(k.length>0)throw new Error("More context objects were passed than there are dynamic segments for the route: "+j);return d||this.invalidateNonDynamicHandlers(e.handlerInfos,n,l),l<i.length?e:a},l.prototype.invalidateNonDynamicHandlers=function(a,b,c){u(b,function(b){if(b>=c){var d=a[b];a[b]=new h({name:d.name,handler:d.handler,params:{}})}})},l.prototype.getHandlerInfoForDynamicSegment=function(a,b,c,d,e,f){{var g;c.length}if(!(d.length>0)){if(e&&e.name===a)return e;throw new Error("Not enough context objects were provided to complete a transition to "+f+". Specifically, the "+a+" route needs an object that can be serialized into its dynamic URL segments ["+c.join(", ")+"]")}return g=d[d.length-1],p(g)?this.createParamHandlerInfo(a,b,c,d,e):(d.pop(),new i({name:a,handler:b,context:g,names:c}))},l.prototype.createParamHandlerInfo=function(a,b,c,d,e){for(var f={},g=c.length;g--;){var i=e&&a===e.name&&e.params||{},j=d[d.length-1],k=c[g];if(p(j))f[k]=""+d.pop();else{if(!i.hasOwnProperty(k))throw new Error("You didn't provide enough string/numeric parameters to satisfy all of the dynamic segments for route "+a);f[k]=i[k]}}return new h({name:a,handler:b,params:f})},m.prototype={resolve:function(a,b,c){function d(){return I.resolve(b()).fail(function(a){throw i=!0,a})}function e(a){throw{error:a,handlerWithError:h.handlerInfos[c.resolveIndex].handler,wasAborted:i,state:h}}function f(a){h.handlerInfos[c.resolveIndex++]=a;var b=a.handler;return b&&b.redirect&&b.redirect(a.context,c),d().then(g)}function g(){if(c.resolveIndex===h.handlerInfos.length)return{error:null,state:h};var b=h.handlerInfos[c.resolveIndex];return b.resolve(a,d,c).then(f)}c=c||{},c.resolveIndex=0;var h=this,i=!1;return I.resolve().then(g).fail(e)}},n.currentSequence=0,n.prototype={targetName:null,urlMethod:"update",intent:null,params:null,pivotHandler:null,resolveIndex:0,handlerInfos:null,resolvedModels:null,isActive:!0,state:null,promise:null,data:null,then:function(a,b){return this.promise.then(a,b)},abort:function(){return this.isAborted?this:(D(this.router,this.sequence,this.targetName+": transition was aborted"),this.isAborted=!0,this.isActive=!1,this.router.activeTransition=null,this)},retry:function(){return this.abort(),F(this.router,this.intent,!1)},method:function(a){return this.intent&&this.intent.inaccessibleByURL||(this.urlMethod=a),this},trigger:function(a){var b=J.call(arguments);"boolean"==typeof a?b.shift():a=!1,x(this.router,this.state.handlerInfos.slice(0,this.resolveIndex+1),a,b)},toString:function(){return"Transition (sequence "+this.sequence+")"},log:function(a){D(this.router,this.sequence,a)}},o.Transition=n,o.TransitionIntent=j,o.TransitionState=m,o.UnresolvedHandlerInfoByParam=h,o.UnresolvedHandlerInfoByObject=i,o.ResolvedHandlerInfo=g,o.HandlerInfo=d,o.NamedTransitionIntent=l,o.URLTransitionIntent=k,c["default"]=o,o.UnrecognizedURLError=function(a){this.message=a||"UnrecognizedURLError",this.name="UnrecognizedURLError"},o.TransitionAborted=function(a){this.message=a||"TransitionAborted",this.name="TransitionAborted"},o.prototype={map:function(a){this.recognizer.delegate=this.delegate,this.recognizer.map(a,function(a,b){var c=b[b.length-1].handler,d=[b,{as:c}];a.add.apply(a,d)})},hasRoute:function(a){return this.recognizer.hasRoute(a)},reset:function(){this.state&&u(this.state.handlerInfos,function(a){var b=a.handler;b.exit&&b.exit()}),this.state=new m,this.currentHandlerInfos=null},activeTransition:null,handleURL:function(a){var b=J.call(arguments);return"/"!==a.charAt(0)&&(b[0]="/"+a),E(this,b).method(null)},updateURL:function(){throw new Error("updateURL is not implemented")},replaceURL:function(a){this.updateURL(a)},transitionTo:function(){return E(this,arguments)},intermediateTransitionTo:function(){E(this,arguments,!0)},replaceWith:function(){return E(this,arguments).method("replace")},queryParamsForHandler:function(a){return q(this,a)},generate:function(a){for(var b=A(J.call(arguments,1)),c=b[0],d=(b[1],new l({name:a,contexts:c})),e=d.applyToState(this.state,this.recognizer,this.getHandler),f={},g=0,h=e.handlerInfos.length;h>g;++g){var i=e.handlerInfos[g],j=i.params||G(i.handler,i.context,i.names);r(f,j)}return this.recognizer.generate(a,f)},isActive:function(a){var b,c,d,e=A(J.call(arguments,1)),f=e[0],h=(e[1],this.state.handlerInfos);if(!h)return!1;var i=[h.length-1].name,j=this.recognizer.handlersFor(i),k=0;for(d=j.length;d>k&&(b=h[k],b.name!==a);++k);if(k===j.length)return!1;var n=new m;n.handlerInfos=h.slice(0,k+1);var o=new l({name:i,contexts:f}),p=o.applyToState(n,this.recognizer,this.getHandler,!1);for(c=0;k>=c;++c)if(b=p.handlerInfos[c],!(b instanceof g))return!1;return!0},trigger:function(){var a=J.call(arguments);x(this,this.currentHandlerInfos,!1,a)},async:function(a){return new I.Promise(function(b){I.async(function(){b(a())})})},log:null}}),window.RouterJs=requireModule("router")}(window);